%{ 
    page = (!_caller.page ? 1 : _caller.page)
    nbPages = _caller.count.page(controllers.Base.getPageSize()) 
}%

#{if nbPages > 1}
    <div class="pagination">
        <ul>
        %{
            limit = (_limit != null ? _limit : 10)
            start = page - (int)(limit/2) + (limit % 2 ? 0 : 1)
            end = page + (int)(limit/2)

            if(start < 1){
                extra = 1 - start
                end = (end + extra < nbPages ? end + extra : nbPages)
                start = 1
            }else if(end > nbPages){
                extra = end - nbPages
                start = (start - extra > 1 ? start - extra : 1)
                end = nbPages
            }
        }%

        #{if page > 1}
            <li class="prev">
                #{crudLink page: page-1, lib: messages.get('previous'), orderBy: _caller.orderBy, order: _caller.order /}
            </li>
        #{/if}

        #{if start > 1}
            <li>
                #{crudLink page: 1, lib: 1, orderBy: _caller.orderBy, order: _caller.order /}
            </li>
            <li class="disabled"><a href="#">…</a></li>
        #{/if}

        %{ for (i in start..end) { }%
            #{if page == i}
                <li class="active">#{crudLink page: i, lib: i, orderBy: _caller.orderBy, order: _caller.order /}</li>
            #{/if}
            #{else}
                <li>#{crudLink page: i, lib: i, orderBy: _caller.orderBy, order: _caller.order /}</li>
            #{/else}
        %{ } }%

        #{if end < nbPages}
            <li class="disabled"><a href="#">…</a></li>
            <li>
                #{crudLink page: nbPages, lib: nbPages, orderBy: _caller.orderBy, order: _caller.order /}
            </li>
        #{/if}

        #{if page < nbPages}
            <li class="next">
                #{crudLink page: page+1, lib: messages.get('next'), orderBy: _caller.orderBy, order: _caller.order /}
            </li>
        #{/if}
        </ul>
    </div>
#{/if}